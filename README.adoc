# cryptowrap image:https://godoc.org/github.com/Djarvur/go-cryptowrap?status.svg["GoDoc",link="http://godoc.org/github.com/Djarvur/go-cryptowrap"] image:https://travis-ci.org/Djarvur/go-cryptowrap.svg["Build Status",link="https://travis-ci.org/Djarvur/go-cryptowrap"] image:https://coveralls.io/repos/Djarvur/go-cryptowrap/badge.svg?branch=master&service=github["Coverage Status",link="https://coveralls.io/github/Djarvur/go-cryptowrap?branch=master"]

JSON-based Marshaler/Unmarshaler with AES encryption

cryptowrap.Wrapper is a struct with custom JSON marshaler and unmarshaler.

Marshaler will encrypt Payload with AES using first value from Keys as a key
and provided IV as an initialisation vector.
Random string will be used if no IV provided.

Actual AES form will be chosen based on first Keys value length.

Serialised data are protected by checksum.

Unmarshaler will decrypt Payload with the Keys provided.
Keys will be tryied one by one until success decryption. Success means checksum check satisfied.
ErrUndecryptable will be returned in case no one key is suitable.

## Example

```
	type toPass struct {
		Insecure string
		Secure   cryptowrap.Wrapper
	}

	type toPassSecure struct {
		Field string
	}

	key := []byte("0123456789ABCDEF")

	srcSecure := toPassSecure{"world!"}

	src := toPass{
		Insecure: "hello",
		Secure: cryptowrap.Wrapper{
			Keys:    [][]byte{key},
			Payload: &srcSecure,
		},
	}

	data, err := json.Marshal(&src)
	if err != nil {
		panic(err)
	}

	//	var onTheGo interface{}
	//
	//	err = json.Unmarshal(data, &onTheGo)
	//	if err != nil {
	//		panic(err)
	//	}
	//
	//	log.Printf("payload is encrypted: %v\n", onTheGo)

	var dstSecure toPassSecure

	dst := toPass{
		Secure: cryptowrap.Wrapper{
			Keys:    [][]byte{key},
			Payload: &dstSecure,
		},
	}

	err = json.Unmarshal(data, &dst)
	if err != nil {
		panic(err)
	}

	fmt.Printf("%v\n", dst.Secure.Payload.(*toPassSecure).Field)
	// Output: world!
```

## Benchmark

Raw is no-encryption wrapper, just to compare with crypto.

```
$go test -bench=. -benchmem
goos: darwin
goarch: amd64
pkg: github.com/Djarvur/cryptowrap
BenchmarkRaw-4                  500000      3073 ns/op        392 B/op   11 allocs/op
BenchmarkWrapper128-4            50000     22673 ns/op       4202 B/op   58 allocs/op
BenchmarkWrapper256-4            50000     26089 ns/op       4850 B/op   58 allocs/op
BenchmarkWrapper128Compress-4     1000   1717042 ns/op   17319552 B/op   77 allocs/op
BenchmarkWrapper256Compress-4     1000   1750608 ns/op   17320554 B/op   78 allocs/op
PASS
ok  	github.com/Djarvur/cryptowrap	8.442s
```
