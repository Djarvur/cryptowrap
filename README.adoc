# cryptowrap image:https://godoc.org/github.com/Djarvur/go-cryptowrap?status.svg["GoDoc",link="http://godoc.org/github.com/Djarvur/go-cryptowrap"] image:https://github.com/Djarvur/go-cryptowrap/workflows/Test/badge.svg?branch=master["Build Status"] image:https://coveralls.io/repos/Djarvur/go-cryptowrap/badge.svg?branch=master&service=github["Coverage Status",link="https://coveralls.io/github/Djarvur/go-cryptowrap?branch=master"]

JSON/Gob/MsgPack-based Marshaler/Unmarshaler with AES encryption

cryptowrap.Wrapper is a struct with custom JSON/Gob/Binary marshaler and unmarshaler.

Marshaler will encrypt Payload with AES using first value from Keys as a key
and provided IV as an initialisation vector.
Random string will be used if no IV provided.

Actual AES form will be chosen based on first Keys value length.

Serialised data are protected by checksum.

Unmarshaler will decrypt Payload with the Keys provided.
Keys will be tryied one by one until success decryption. Success means checksum check satisfied.
ErrUndecryptable will be returned in case no one key is suitable.

## Example

```
	type toPass struct {
		Insecure string
		Secure   cryptowrap.Wrapper
	}

	type toPassSecure struct {
		Field string
	}

	key := []byte("0123456789ABCDEF")

	srcSecure := toPassSecure{"world!"}

	src := toPass{
		Insecure: "hello",
		Secure: cryptowrap.Wrapper{
			Keys:    [][]byte{key},
			Payload: &srcSecure,
		},
	}

	data, err := json.Marshal(&src)
	if err != nil {
		panic(err)
	}

	//	var onTheGo interface{}
	//
	//	err = json.Unmarshal(data, &onTheGo)
	//	if err != nil {
	//		panic(err)
	//	}
	//
	//	log.Printf("payload is encrypted: %v\n", onTheGo)

	var dstSecure toPassSecure

	dst := toPass{
		Secure: cryptowrap.Wrapper{
			Keys:    [][]byte{key},
			Payload: &dstSecure,
		},
	}

	err = json.Unmarshal(data, &dst)
	if err != nil {
		panic(err)
	}

	fmt.Printf("%v\n", dst.Secure.Payload.(*toPassSecure).Field)
	// Output: world!
```

## Benchmark

Raw is no-encryption wrapper, just to compare with crypto.

```
$go test -bench=. -benchmem
goos: darwin
goarch: amd64
pkg: github.com/Djarvur/cryptowrap
BenchmarkRawJSON-4                  535210      2070 ns/op        520 B/op    14 allocs/op
BenchmarkRawGob-4                    45284     27297 ns/op      10455 B/op   255 allocs/op
BenchmarkRawMsgp-4                  272006      3958 ns/op       3728 B/op    41 allocs/op
BenchmarkWrapperJSON128-4            74348     15555 ns/op       4194 B/op    59 allocs/op
BenchmarkWrapperJSON256-4            66972     17839 ns/op       4834 B/op    59 allocs/op
BenchmarkWrapperJSON128Compress-4      777   1423461 ns/op   17318819 B/op    79 allocs/op
BenchmarkWrapperJSON256Compress-4      729   1508109 ns/op   17319469 B/op    79 allocs/op
BenchmarkWrapperGob128-4             10000    108758 ns/op      39948 B/op   890 allocs/op
BenchmarkWrapperGob256-4             10000    100913 ns/op      40444 B/op   890 allocs/op
BenchmarkWrapperGob128Compress-4       716   1673315 ns/op   17353052 B/op   902 allocs/op
BenchmarkWrapperGob256Compress-4       740   1659393 ns/op   17353589 B/op   902 allocs/op
BenchmarkWrapperMsgp128-4            71518     16779 ns/op      15472 B/op   151 allocs/op
BenchmarkWrapperMsgp256-4            69636     17408 ns/op      15904 B/op   151 allocs/op
BenchmarkWrapperMsgp128Compress-4      771   1549084 ns/op   17327702 B/op   160 allocs/op
BenchmarkWrapperMsgp256Compress-4      820   1548949 ns/op   17328341 B/op   161 allocs/op
PASS
ok  	github.com/Djarvur/cryptowrap	19.441s
```
